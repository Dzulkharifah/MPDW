---
title: "Tugas P5 MPDW"
author: "Indah Dzulkharifah"
format: 
  html:
    embed-resources: true
    toc: true
    self-contained: true
---

# White Noise

\Pembangkitan data berpola AR, MA, ARMA, dan banyak proses deret waktu lainnya diawali pembangkitan *white noise*. *White noise* merupakan sederet nilai dari peubah bebas stokastik identik. Oleh karena itu, *white noise* memiliki dua karakteristik penting:

1.  *White noise* tidak memiliki autokorelasi (**karena saling bebas**)
2.  Nilai harapan dan ragam *white noise* sama (**karena berasal dari peubah acak bebas stokastik identik**)

*White noise* dibangkitkan dari suatu peubah acak, umumnya peubah acak normal.


```{r}
set.seed(1050)
wn <- rnorm(300)
ts.plot(wn)
```

Dapat terlihat bahwa *white noise* tidak memiliki autokorelasi dari ACF. Perhatikan bahwa lag ke-0 adalah korelasi observasi ke-t dengan dirinya sendiri. Nilai korelasi tersebut pasti 1. Sebagai alternatif, lag pertama di plot ACF dapat ditetapkan sebagai 1 (alih-alih 0) dengan menambahkan argumen `xlim(1, lag akhir)`. Plot tersebut dapat disandingkan bersamaan dengan membuat matriks $1 \times 2$ dengan `par(mfrow = c(1,2))`.

```{r}
par(mfrow = c(1, 2)) 
acf(wn)
acf(wn, xlim = c(1, 20))
```

# Proses MA

Proses MA dapat dituliskan sebagai berikut:

$$
y_{t} = c + e_t + \theta_{1}e_{t-1} + \theta_{2}e_{t-2} + \dots + \theta_{q}e_{t-q} = c+{e_t+\sum_{i=1}^p \theta_ie_{t-i}}
$$
## Pembangkitan Proses MA(2)

### Bangkitan Manual

```{r}
set.seed(1050)
MA<- wn[c(1,2)]
MA
```

Persamaan MA(2) adalah sebagai berikut:

$$
y_t = e_t+0.4e_{t-1}+0.6e_{t-2}
$$

```{r}
set.seed(1050)
for(i in 3:300){
   MA[i] <- wn[i] + 0.4 * wn[i - 1] +  0.6 * wn[i - 2] 
}
MA
```

### Bangkitan arima.sim

```{r}
set.seed(1050)
MA2 <- arima.sim(list(order=c(0,0,2), ma=c(0.4,0.6)), n=300)
MA2
```

## Karakteristik MA(2)

### Plot Time Series


```{r}
ts.plot(MA2)
```

Berdasarkan plot time series, terlihat bahwa data MA(2) yang dibangkitkan stasioner dalam rataan

### Plot ACF

```{r}
acf(MA2,lag.max = 20)
```

Berdasarkan plot ACF tersebut, terlihat bahwa plot ACF cuts off di lag kedua


### Plot PACF

```{r}
pacf(MA2)
```

Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cenderung tails off dan membentuk gelombang sinus

### Plot EACF

```{r}
TSA::eacf(MA2)
```

Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol berada pada ordo AR(0) dan ordo MA(2)

## Scatterplot Antar Lag

### Korelasi antara $Y_t$ dengan $Y_{t−1}$

```{r}
#Yt
yt_MA2 <- MA2[-1]
yt_MA2
```
```{r}
#Yt-1
yt_1_MA2 <- MA2[-300]
yt_1_MA2
```
```{r}
plot(y=yt_MA2,x=yt_1_MA2)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-1}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt_MA2,yt_1_MA2)
```

Korelasi antara $Y_t$ dengan $Y_{t-1}$ dari hasil simulasi mendekati perhitungan teoritis yaitu

$$
\rho_1 = \frac{-\theta_1 + \theta_1 \theta_2}{1 + \theta_1^2 + \theta_2^2} 
= \frac{-(-0.4) + (0.4)(0.6)}{1 + (0.4)^2 + (0.6)^2} 
= \frac{0.64}{1.52} 
= 0.42
$$

### Korelasi antara $Y_t$ dengan $Y_{t-2}$

```{r}
#Yt
yt_MA2 <- MA2[-c(1,2)]
yt_MA2
```
```{r}
#Yt-2
yt_2_MA2 <- MA2[-c(299,300)]
yt_2_MA2
```
```{r}
plot(y=yt_MA2,x=yt_2_MA2)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-2}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt_MA2,yt_2_MA2)
```
Korelasi antara $Y_t$ dengan $Y_{t-2}$ dari hasil simulasi mendekati perhitungan teoritis yaitu


$$
\rho_2 = \frac{-\theta_2}{1 + \theta_1^2 + \theta_2^2} 
= \frac{-(-0.6)}{1 + (0.4)^2 + (0.6)^2} 
= \frac{0.6}{1.52} 
= 0.3947
$$

### Korelasi antara $Y_t$ dengan $Y_{t-3}$

```{r}
#Yt
yt_MA2 <- MA2[-c(1,2,3)]
yt_MA2
```
```{r}
#Yt-3
yt_3_MA2 <- MA2[-c(298,299,300)]
yt_3_MA2
```
```{r}
plot(y=yt_MA2,x=yt_3_MA2)
```

Berdasarkan scatterplot tersebut, terlihat bahwa cenderung tidak terdapat hubungan antara $Y_t$ dengan $Y_{t-3}$.

```{r}
cor(yt_MA2,yt_3_MA2)
```
Korelasi antara $Y_t$ dengan $Y_{t-3}$ hasil simulasi mendekati teori yang ada yaitu 0.


# Proses AR

Proses AR dapat dituliskan sebagai berikut:

$$ y_{t} = c + e_t + \phi_{1}Y_{t-1} + \phi_{2}Y_{t-2} + \dots + \phi_{q}Y_{t-q} = c+{e_t+\sum_{i=1}^p \phi_iY_{t-i}} $$ 

Terlihat bahwa $Y_t$ berperan penting dalam pembangkitan proses AR.

## Pembangkitan Proses AR

### Bangkitan Manual

Persamaan AR(2) adalah sebagai berikut:

$$ Y_t = e_t+0.5Y_{t-1}+0.2Y_{t-2}$$

```{r}
set.seed(1050)
n<-length(wn)
n

AR <- c(2:n) 
for (i in 3:n) {AR[i]<-wn[i]+0.5*AR[i-1]+0.2*AR[i-2]}
AR
```


### Bangkitan arima.sim

```{r}
set.seed(1050)
aR2 <- arima.sim(list(order=c(2,0,0), ar=c(0.5,0.2)), n=300)
aR2
```

## Karakteristik AR(2)

### Plot Time Series

```{r}
ts.plot(aR2)
```
Berdasarkan plot time series tersebut terlihat bahwa data cenderung stasioner pada rataan

### Plot ACF

```{r}
acf(aR2)
```

Berdasarkan plot ACF tersebut terlihat bahwa plot ACF cenderung tails off 

### Plot PACF

```{r}
pacf(aR2)
```

Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cuts off pada lag kedua, sejalan dengan teori yang ada

### Plot EACF

```{r}
TSA::eacf(aR2)
```
Berdasarkan pola segitiga nol pada plot EACF, tidak terlihat bahwa segitiga nol berada pada ordo AR(2).

## Scatterplot Antar Lag

### Korelasi antara $Y_t$ dengan $Y_{t-1}$

```{r}
#Yt
yt_aR2 <- aR2[-1]
yt_aR2
```
```{r}
#Yt-1
yt_1_aR2 <- aR2[-300]
yt_1_aR2
```
```{r}
plot(y=yt_aR2,x=yt_1_aR2)
```
Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-1}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt_aR2,yt_1_aR2)
```
Korelasi antara $Y_t$ dengan $Y_{t-1}$ dari hasil simulasi mendekati perhitungan teoritis yaitu

$$
\text{(Yule--Walker)}\qquad
\rho_1 = \frac{\phi_1}{1-\phi_2}
 = \frac{0.5}{1-0.2} = \frac{0.5}{0.8} = 0.625
$$

### Korelasi antara $Y_t$ dengan $Y_{t-2}$

```{r}
#Yt
yt2_aR2 <- aR2[-c(1,2)]
yt2_aR2
```
```{r}
#Yt-2
yt_2_aR2 <- aR2[-c(299,300)]
yt_2_aR2
```
```{r}
plot(y=yt2_aR2,x=yt_2_aR2)
```
Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-2}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt2_aR2,yt_2_aR2)
```
Korelasi antara $Y_t$ dengan $Y_{t-1}$ dari hasil simulasi mendekati perhitungan teoritis yaitu

$$
\rho_2 = \phi_1 \rho_1 + \phi_2
= \frac{\phi_1^2}{1-\phi_2} + \phi_2
= \frac{\phi_2(1-\phi_2) + \phi_1^2}{1-\phi_2}
= \frac{0.5^2}{1-0.2} + 0.2
= \frac{0.25}{0.8} + 0.2
= 0.3125 + 0.2
= 0.5125
$$

### Korelasi antara $Y_t$ dengan $Y_{t-3}$

```{r}
#Yt
yt3_aR2 <- aR2[-c(1,2,3)]
yt3_aR2
```
```{r}
#Yt-3
yt_3_aR2 <- aR2[-c(298,299,300)]
yt_3_aR2
```

```{r}
plot(y=yt3_aR2,x=yt_3_aR2)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-3}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt3_aR2,yt_3_aR2)
```

Korelasi antara $Y_t$ dengan $Y_{t-3}$ dari hasil simulasi mendekati perhitungan teoritis yaitu

$$
\rho_3 = \phi_1 \rho_2 + \phi_2 \rho_1
= (0.5)(0.5125) + (0.2)(0.625)
= 0.25625 + 0.125
= 0.38125
$$

# Proses ARMA

## Fungsi pembangkitan ARMA

bentuk umum data berpola ARMA.

$$
y_{t} = c + \sum_{i=1}^p \phi_{i}y_{t-i} + \sum_{j=1}^q e_{t-j}+ e_{t}
$$
```{r}
set.seed(1050)
coefs <- c(0.5, 0.2)
e <- c(1, 2)

coefs %*% e
```

```{r}
coefs * e
```

```{r}
sum(coefs * e)
```
```{r}
arma.sim <- function(n, macoef, arcoef){
  manum <- length(macoef)
  arnum <- length(arcoef)
  stopifnot(manum < n & arnum < n)
  
  wn <- rnorm(n, sd = 0.5)
  init <- max(manum, arnum)

  arma <- wn[1:init]
  for(i in {init+1}:n){
   mastart <- i - manum
   maend <- i-1
   arstart <- i - arnum
   arend <- i-1
   arma[i] <- sum(arcoef * arma[arstart:arend]) + sum(macoef * wn[mastart:maend])  + wn[i]
   }
  return(arma)
}
```

```{r}
#contoh untuk ARMA
arma22 <- arma.sim(300, c(0.5, 0.2), c(0.4,0.6))

arma22 |> arima(c(2,0,2))
```

### Bangkitan Manual

Persamaan ARMA(2,2) sebagai berikut:

$$
\text{Model:}\qquad
Y_t = 0.5 Y_{t-1} + 0.2 Y_{t-2} + e_t + 0.4e_{t-1} + 0.6e_{t-2}.
$$

```{r}
set.seed(1050)
n = length(wn)
phi1 = 0.5
theta1 = 0.4
phi2=0.2
theta2=0.6

y.arma=c(1:n)
for (i in 3:n){y.arma[i] = phi1*y.arma[i-1] + theta1*wn[i-1] + phi2*y.arma[i-2] + theta2*wn[i-2]+wn[i]}
y.arma
```


### Bangkitan arima.sim

```{r}
set.seed(1050)
arma22 <- arima.sim(list(order=c(2,0,2), ar = c(0.5,0.2), ma = c(0.4,0.6)), n=300)
arma22
```


## Karakteristik ARMA(2,2)

### Plot Time Series

```{r}
par(mfrow = c(1, 2))
ts.plot(y.arma)
ts.plot(arma22)
```

```{r}
par(mfrow = c(1, 1))
```

Berdasarkan plot time series tersebut, terlihat bahwa model ARMA(2,2) cenderung stasioner dalam rataan

### Plot ACF

```{r}
par(mfrow = c(1, 2))
acf(y.arma)
acf(arma22)
```
```{r}
par(mfrow = c(2, 2))
```

Berdasarkan plot ACF tersebut, terlihat bahwa model ARMA(2,2) hasil simulasi memiliki plot ACF yang tails off, sesuai dengan teori yang ada

### Plot PACF

```{r}
par(mfrow = c(1, 2))
pacf(y.arma)
pacf(arma22)

```

```{r}
par(mfrow = c(2, 2))
```

Berdasarkan plot PACF tersebut, terlihat bahwa model ARMA(2,2) hasil simulasi memiliki plot PACF yang tails off, sesuai dengan teori

### Plot EACF

```{r}
TSA::eacf(y.arma)
```
```{r}
TSA::eacf(arma22)
```

Berdasarkan pola segitiga nol pada plot EACF, tidak terlihat bahwa segitiga nol berada pada ordo AR(2) dan MA(2).

## Scatterplot Antar Lag

### Korelasi antara $Y_t$ dengan $Y_{t−1}$

```{r}
#Yt
yt1_arma <- arma22[-1]
yt1_arma
```
```{r}
#Yt-1
yt_1_arma <- arma22[-300]
yt_1_arma
```

```{r}
plot(y=yt1_arma,x=yt_1_arma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t−1}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt1_arma,yt_1_arma)
```

Korelasi antara $Y_t$ dengan $Y_{t−1}$ dari hasil simulasi mendekati perhitungan teoritis.




$$
\text{Yule--Walker (gammas):}\qquad
\begin{aligned}
\gamma_0 &= \phi_1\gamma_1 + \phi_2\gamma_2 + \sigma^2(1+\theta_1^2+\theta_2^2),\\[6pt]
\gamma_1 &= \phi_1\gamma_0 + \phi_2\gamma_1 + \sigma^2(\theta_1+\theta_1\theta_2),\\[6pt]
\gamma_2 &= \phi_1\gamma_1 + \phi_2\gamma_0 + \sigma^2\theta_2.
\end{aligned}
$$






$$
\text{Substitusi } \phi_1=0.5,\ \phi_2=0.2,\ \theta_1=0.4,\ \theta_2=0.6,\ \sigma^2=1:
$$





$$
1+\theta_1^2+\theta_2^2 = 1 + 0.4^2 + 0.6^2 = 1.52,\qquad
\theta_1+\theta_1\theta_2 = 0.4 + 0.4\cdot0.6 = 0.64.
$$





$$
\begin{aligned}
\gamma_0 &= 0.5\gamma_1 + 0.2\gamma_2 + 1.52,\\[6pt]
\gamma_1 &= 0.5\gamma_0 + 0.2\gamma_1 + 0.64,\\[6pt]
\gamma_2 &= 0.5\gamma_1 + 0.2\gamma_0 + 0.6.
\end{aligned}
$$





$$
\text{Menyelesaikan sistem di atas (aljabar/numerik) memberi:}
$$





$$
\gamma_0 \approx 3.6239316239,\qquad
\gamma_1 \approx 3.06495726496,\qquad
\gamma_2 \approx 2.85726495726.
$$



$$
\text{Autokorelasi:}\qquad
\rho_k = \frac{\gamma_k}{\gamma_0}.
$$



$$
\rho_1 = \frac{\gamma_1}{\gamma_0} \approx 
\frac{3.06495726496}{3.6239316239} \approx 0.845754717
$$



### Korelasi antara $Y_t$ dengan $Y_{t−2}$

```{r}
#Yt
yt2_arma <- arma22[-c(1,2)]
yt2_arma
```
```{r}
#Yt-1
yt_2_arma <- arma22[-c(299,300)]
yt_2_arma
```
```{r}
plot(y=yt2_arma,x=yt_2_arma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t−1}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt2_arma,yt_2_arma)
```
Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t−1}$. Hal ini sesuai dengan teori yang ada, yaitu 

$$
\rho_2 = \frac{\gamma_2}{\gamma_0} \approx 
\frac{2.85726495726}{3.6239316239} \approx 0.788443396
$$

### Korelasi antara $Y_t$ dengan $Y_{t−3}$

```{r}
#Yt
yt3_arma <- arma22[-c(1,2,3)]
yt3_arma
```

```{r}
#Yt-3
yt_3_arma <- arma22[-c(298,299,300)]
yt_3_arma
```
```{r}
plot(y=yt3_arma,x=yt_3_arma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t−3}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt3_arma,yt_3_arma)
```

$$
\rho_3 = \phi_1\rho_2 + \phi_2\rho_1 =
0.5\cdot 0.788443396 + 0.2\cdot 0.845754717
\approx 0.563372642
$$
